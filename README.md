# NPDP Bench

Non-serial polyadic dynamic programming benchmarks (NPDP Bench) to test automatic source-to-source optimizing compilers and manual transformations. Programs are written in C/C++ and OpenMP is supported.

## Configuration

The `PLUTO` env variable should be set to allow make to generate pluto source files.

## Utilities

Files ending with .pluto.c should be generated and not included in this repository.

A Makefile is available in each program directory
Targets available:

- `$(PROG)` original sequential program
- `$(PROG)_pluto` pluto optimized program. The pluto source file will be generated by calling pluto
- `clean` remove all binaries and generated source files

## Macros

For all programs you can define some macro that will change the behaviour of the program.
You can define them at compile time:
```bash
gcc -o prog prog.c -O3 -fopenmp -DMACRO1 -DMACRO2=423
```

- `METRICS_TIME` if defined, the program will measure the time spent in the main computation kernel. Unset by default
- `N` usually the size of the dataset. Default is 8
- `RSEED` seed used for random number generation. Default is `time(NULL)`
- `RESULT_DUMP` if defined, the program will dump the result of its computation in stderr. Unset by default

## Useful tools

### get_chksum.sh

This script will run the given make target, dump the result into a file and then print the sha256sum of the result file.
Useful to compare original sequential code result with a generated optimized code result and check if the optimized program is correct.

Usage:

```bash
 ./get_chksum.sh [extra_flags] <target>
```

Example:

```bash
# inside a benchmark directory like ./counting
../tools/get_chksum.sh "-DMETRICS_TIME -DN=200 -DRSEED=21" counting
# Output
rm -f counting counting_pluto  *.pluto.c *.cloog
gcc -march=native -O3 -fopenmp -o counting counting.c -lm -I ../include/ -DMETRICS_TIME -DN=200 -DRSEED=46526 -DRESULT_DUMP
0.002771
rm -f counting counting_pluto  *.pluto.c *.cloog
3181108660df2912a9866661ab3d81dad9fa72da1ce087e545d5cae309bd57fa
```
